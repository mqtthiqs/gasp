\begin{figure}
\boxedtitle{\tcterm{\tyenv}{\term}{\type}}
\begin{center}
\begin{mathpar}
\infer{
\tcterm{\tenvcons{\tyenv}{\binding}}{\term}{\type}
}{
\tcterm{\tyenv}{\tlam{\binding}{\term}}{\typrod{\binding}{\type}}
}

\infer{
\openscope{\tyenv}{\tenvlookup{\tyenv}{\var}}{\listof\adef} \\
\tcterm{\tyenv\listof\adef}{\term}{\type}
}{
\tcterm{\tyenv}{\topen{\term}{\var}}{\tyopen{\type}{\var}}
}
\\
\infer{
\tcdefs{\tyenv}{\listof\adef} \\\\
\tcterm{\tenvcons{\tyenv}{\listof\adef}}{\term}{\type}
}{
\tcterm{\tyenv}{\tdef{\listof\adef}{\term}}{\tydef{\listof\adef}\type}
}

\infer{
\distinctheads{\tyenv}{\spine}\\\\
\tcspine{\tyenv}{\tenvlookuptype{\tyenv}{\head}}{\spine}{\type}
}{
\tcterm{\tyenv}{\tapp{\var}{\spine}}{\type}
}

\infer{
\tcspine{\tyenv}{\tenvlookuptype{\tyenv}{\head}}{\spine}{\type}
}{
\tcterm{\tyenv}{\tapp{\constant}{\spine}}{\type}
}
\end{mathpar}
\end{center}
\boxedtitle{\distinctheads{\tyenv}{\spine}}
\begin{center}
\begin{mathpar}
\infer{
}{
\distinctheads{\tyenv}{\emptylist}
}

\infer{
\forall \head', \spine = \spine_1 \head' \spine_2 \Rightarrow \head \not\equiv \head' \\
\distinctheads{\tyenv}{\spine}
}{
\distinctheads{\tyenv}{\head\spine}
}
\end{mathpar}
\end{center}
\boxedtitle{\tcspine{\tyenv}{\type}{\spine}{\type}}
\begin{center}
\begin{mathpar}
\infer{
\equaltype{\tyenv}{\type}{\tenvlookuptype{\tyenv}{\head}} \\\\
\tcspine{\tenvdef{\tyenv}{\var}{\head}{\type}}
        {\typebis}
        {\spine}
        {\typebis'}
}{
\tcspine{\tyenv}
        {\typrod{\bind{\var}{\promise}{\type}}{\typebis}}
        {\head\spine}
        {\typebis'}
}

\infer{
\openscope{\tyenv}{\tenvlookup{\tyenv}{\var}}{\listof\adef} \\\\
\tcspine{\tenvcons{\tyenv}{\listof\adef}}
        {\type}
        {\spine}
        {\typebis}
}{
\tcspine{\tyenv}
        {\topen{\type}{\var}}
        {\spine}
        {\tydef{\listof\adef}\typebis}
}

\infer{
\tcspine{\tyenv\listof\adef}
        {\type}
        {\spine}
        {\typebis}
}{
\tcspine{\tyenv}
        {\tydef{\listof\adef}{\type}}
        {\spine}
        {\tydef{\listof\adef}{\typebis}}
}

\infer{
}{
\tcspine{\tyenv}
        {\type}
        {\emptylist}
        {\type}
}
\end{mathpar}
\end{center}

\boxedtitle{\tcdefs{\tyenv}{\listof\adef}}
\begin{center}
\begin{mathpar}
\infer{
}{
\tcdefs{\tyenv}{\emptylist}
}

\infer{
\tcterm{\tyenv}{\term}{\typebis} \\
\equaltype{\tyenv}{\type}{\typebis} \\
\tcdefs{\tyenv\xadef{\var}{\term}{\type}}{\listof\adef}
}{
\tcdefs{\tyenv}{\xadef{\var}{\term}{\type}\listof\adef}
}
\end{mathpar}
\end{center}

% Kind? Signature? Environment?
\caption{Type checking algorithm.}
\end{figure}
