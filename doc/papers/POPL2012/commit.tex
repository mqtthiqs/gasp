\begin{figure}
\begin{center}
\begin{mathpar}
\boxed{\tcterm{\tyenv}{\term}{\type}}\\
\infer{
\tcterm{\tenvcons{\tyenv}{\binding}}{\term}{\type}
}{
\tcterm{\tyenv}{\tlam{\binding}{\term}}{\typrod{\binding}{\type}}
}

\infer{
\openscope{\tyenv}{\tenvlookup{\tyenv}{\var}}{\listof\adef} \\
\tcterm{\tyenv\listof\adef}{\term}{\type}
}{
\tcterm{\tyenv}{\topen{\term}{\var}}{\tyopen{\type}{\var}}
}
\\
\infer{
\tcdefs{\tyenv}{\listof\adef} \\\\
\tcterm{\tenvcons{\tyenv}{\listof\adef}}{\term}{\type}
}{
\tcterm{\tyenv}{\tdef{\listof\adef}{\term}}{\tydef{\listof\adef}\type}
}

\infer{
\distinctheads{\tyenv}{\listof\head}\\\\
\tcspine{\tyenv}{\tenvlookuptype{\tyenv}{\head}}{\listof\head}{\type}
}{
\tcterm{\tyenv}{\tapp{\var}{\listof\head}}{\type}
}

\infer{
\tcspine{\tyenv}{\tenvlookuptype{\tyenv}{\head}}{\listof\head}{\type}
}{
\tcterm{\tyenv}{\tapp{\constant}{\listof\head}}{\type}
}
\end{mathpar}
\end{center}
\begin{center}
\begin{mathpar}
\boxed{\distinctheads{\tyenv}{\listof\head}}\\
\infer{
}{
\distinctheads{\tyenv}{\emptylist}
}

\infer{
\forall \head', \listof\head = \listof\head_1 \head' \listof\head_2 \Rightarrow \head \not\equiv \head' \\
\distinctheads{\tyenv}{\listof\head}
}{
\distinctheads{\tyenv}{\head\listof\head}
}
\end{mathpar}
\end{center}
\begin{center}
\begin{mathpar}
\boxed{\tcspine{\tyenv}{\type}{\listof\head}{\type}}\\
\infer{
\equaltype{\tyenv}{\type}{\tenvlookuptype{\tyenv}{\head}} \\\\
\tcspine{\tenvdef{\tyenv}{\var}{\head}{\type}}
        {\typebis}
        {\listof\head}
        {\typebis'}
}{
\tcspine{\tyenv}
        {\typrod{\bind{\var}{\promise}{\type}}{\typebis}}
        {\head\listof\head}
        {\typebis'}
}

\infer{
\openscope{\tyenv}{\tenvlookup{\tyenv}{\var}}{\listof\adef} \\\\
\tcspine{\tenvcons{\tyenv}{\listof\adef}}
        {\type}
        {\listof\head}
        {\typebis}
}{
\tcspine{\tyenv}
        {\topen{\type}{\var}}
        {\listof\head}
        {\tydef{\listof\adef}\typebis}
}

\infer{
\tcspine{\tyenv\listof\adef}
        {\type}
        {\listof\head}
        {\typebis}
}{
\tcspine{\tyenv}
        {\tydef{\listof\adef}{\type}}
        {\listof\head}
        {\tydef{\listof\adef}{\typebis}}
}

\infer{
}{
\tcspine{\tyenv}
        {\type}
        {\emptylist}
        {\type}
}
\end{mathpar}
\end{center}

\begin{center}
\begin{mathpar}
\boxed{
\tcdefs{\tyenv}{\listof\adef}
}\\
\infer{
}{
\tcdefs{\tyenv}{\emptylist}
}

\infer{
\tcterm{\tyenv}{\term}{\typebis} \\
\equaltype{\tyenv}{\type}{\typebis} \\
\tcdefs{\tyenv\xadef{\var}{\term}{\type}}{\listof\adef}
}{
\tcdefs{\tyenv}{\xadef{\var}{\term}{\type}\listof\adef}
}
\end{mathpar}
\end{center}

% Kind? Signature? Environment?
\caption{Type checking algorithm.}
\end{figure}
