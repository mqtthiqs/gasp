\begin{figure}
\boxed{
\equalterm{\tyenv}{\term}{\term}{\type}
}
\begin{center}
\begin{mathpar}
\infer{
\whnf{\tyenv}{\term}{\type}{\emptylist}{\adefs}{\term'}\\\\
\whnf{\tyenv}{\termbis}{\type}{\emptylist}{{\adefs}'}{\termbis'}\\\\
\equalwhnfterm{\tenvcons{\tenvcons{\tyenv}{\adefs}}{{\adefs}'}}
              {\term'}
              {\termbis'}
              {\type}
}{
\equalterm{\tyenv}{\term}{\termbis}{\type}
}
\end{mathpar}
\end{center}

\boxed{
\equalwhnfterm{\tyenv}{\term}{\term}{\type}
}
\begin{center}
\begin{mathpar}
\infer{
\equalspine{\tyenv}{\tenvlookuptype{\tyenv}{\head}}{\spine}{{\spine}'}
}{
\equalwhnfterm{\tyenv}{\tapp{\head}{\spine}}{\tapp{\head}{{\spine}'}}
              {\type}
}

\infer{
\whnfbis{\tyenv}
     {\tenvlookup{\tyenv}{\var}}
     {\spine}
     {\adefs}{\term'}\\\\
\whnfbis{\tyenv}
     {\tenvlookup{\tyenv}{\var'}}
     {{\spine}'}{{\adefs}'}{\termbis'}\\\\
\equalwhnfterm{\tenvcons{\tenvcons{\tyenv}{\adefs}}{{\adefs}'}}
              {\term'}
              {\termbis'}
              {\type}
}{
\equalwhnfterm{\tyenv}
              {\tapp{\var}{\spine}}
              {\tapp{\var'}{{\spine}'}}
              {\type}
}

\infer{
\equalwhnfterm{\tenvbind{\tyenv}{\var}{\promise}{\type}}
              {\term}
              {\tapp{\head}{\concat{\spine}{\var}}}
              {\type}
}{
\equalwhnfterm{\tyenv}
              {\tlam{\bind{\var}{\promise}{\type}}{\term}}
              {\tapp{\head}{\spine}}
              {\typrod{\bind{\var}{\promise}{\type}}\type}
}

\infer{
\equalwhnfterm{\tenvbind{\tyenv}{\var}{\promise}{\type}}
              {\term}
              {\termbis}
              {\type}
}{
\equalwhnfterm{\tyenv}
              {\tlam{\bind{\var}{\promise}{\type}}{\term}}
              {\tlam{\bind{\var}{\promise}{\type}}{\termbis}}
              {\typrod{\bind{\var}{\promise}{\type}}\type}
}

% FIXME: Manque les cas ``type = \tyopen{}{}'' et ``type = \tydef{}{}''. 
% FIXME: Manque aussi quelque cas symetrique ... 
% FIXME: On omet?
\end{mathpar}
\end{center}

\boxed{
\equaltype{\tyenv}{\type}{\type}
}
\begin{center}
\begin{mathpar}
% FIXME: Il faut argumenter ici que le choix arbitraire de \promise est correct. 
\infer{
\equaltype{\tyenv}{\type}{\type'} \\
\equaltype{\tenvbind{\tyenv}{\var}{\promise}{\type}}
          {\typebis}
          {\typebis'}
}{
\equaltype{\tyenv}
          {\typrod{\bind{\var}{\promise}{\type}}{\typebis}}
          {\typrod{\bind{\var}{\promise'}{\type'}}{\typebis'}}
}

\infer{
% FIXME: Refer to signature for constant!
\equalspine{\tyenv}{\tenvlookuptype{\tyenv}{\tyconstant}}{\spine}{{\spine}'}
}{
\equaltype{\tyenv}
          {\tyapp{\tyconstant}{\spine}}
          {\tyapp{\tyconstant}{{\spine}'}}
          {}
}
% FIXME: Manque les cas ``type = \tyopen{}{}'' et ``type = \tydef{}{}''. 
% FIXME: Manque aussi quelque cas symetrique ... 
% FIXME: On omet?
\end{mathpar}
\end{center}

\boxed{
\equalspine{\tyenv}{\type}{\spine}{\spine}
}
\begin{center}
\begin{mathpar}
\infer{
}{
\equalspine{\tyenv}{\type}{\emptylist}{\emptylist}
}

\infer{
\equalspine{\tyenv}
           {\typebis}
           {{\spine}}
           {{\spine}'}
}{
\equalspine{\tyenv}
           {\typrod{\bind{\var}{\promise}{\type}}{\typebis}}
           {\head{\spine}}
           {\head{\spine}'}
}

\infer{
\equalterm{\tyenv}{\tenvlookup{\tyenv}{\var}}{\tenvlookup{\tyenv}{\var'}}{\type}\\
\equalspine{\tenvdef{\tyenv}{\var}{\var'}{\type}}
           {\typebis}
           {{\spine}}
           {{\spine}'}
}{
\equalspine{\tyenv}
           {\typrod{\bind{\var}{\pused}{\type}}{\typebis}}
           {\var{\spine}}
           {\var'{\spine}'}
}

\infer{
\equalspine{\tenvdef{\tyenv}{\var}{\var'}{\type}}
           {\typebis}
           {{\spine}}
           {{\spine}'}
}{
\equalspine{\tyenv}
           {\typrod{\bind{\var}{\punused}{\type}}{\typebis}}
           {\var{\spine}}
           {\var'{\spine}'}
}
\end{mathpar}
\end{center}

% FIXME: Kind equality? 
\caption{Decision procedure for equality. (Some obvious cases are omitted.)}
\end{figure}
